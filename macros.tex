%
%
% define constants
%
\newdimen\chordsaboveline%
\chordsaboveline=\bigskipamount%
%
\newdimen\minchordseparation%
\minchordseparation=0.5em%
%
\newdimen\chorddisplacementtolerance%
\chorddisplacementtolerance=3pt%
%
\newdimen\startskip%
\startskip=1em%
%
\newdimen\blockseparator%
\blockseparator=\bigskipamount%
\advance\blockseparator by -1pt
%
\newdimen\chordextraspacetolerance%
\chordextraspacetolerance=1em%
%
% define variables%
%
\newdimen\res%
\newdimen\bottomline%
\newdimen\topline%
\newdimen\tempdimen%
\newdimen\currentlyricskip%
%
% define macros%
%
% macros for chords
\def\measure#1{{\setbox0=\hbox{#1}\global\res=\wd0}}%
\def\chordline#1{{%
%
\def\chordstrut{\hbox{\vrule height 10pt width 0pt depth 3.5pt}}
\def\chordformat##1{\hbox{\chordstrut\bf ##1}}%
\def\setchord##1{\hbox{\raise\chordsaboveline\chordformat{##1}}}%
%
\bottomline=0pt%
\topline=0pt%
\currentlyricskip=0pt%
%
\def\topcontent{}%
\def\bottomcontent{}%
%
\def\lyricsspace##1{\ifdim\currentlyricskip>0pt\edef\doskip{\hskip\the\currentlyricskip}\else\def\doskip{}\fi\currentlyricskip=0pt\edef\bottomcontent{\bottomcontent\doskip##1}\measure{\bottomcontent}\bottomline=\res}%
\def\lyrics##1{\ifdim\currentlyricskip>0pt\advance\currentlyricskip by -\chorddisplacementtolerance\edef\doskip{\hskip0.5\chorddisplacementtolerance\hbox{\vrule width\the\currentlyricskip height0.6ex depth-0.5ex}\hskip0.5\chorddisplacementtolerance}\else\def\doskip{}\fi\currentlyricskip=0pt\edef\bottomcontent{\bottomcontent\doskip##1}\measure{\bottomcontent}\bottomline=\res}%
\def\chord##1{%
\ifdim\bottomline>\topline%
\tempdimen=\bottomline%
\advance\tempdimen by -\topline%
\edef\topcontent{\topcontent\hskip\the\tempdimen\setchord{##1}\hskip\minchordseparation}%
\else%
\tempdimen=\topline%
\advance\tempdimen by -\bottomline%
\ifdim\tempdimen<\chorddisplacementtolerance%
\edef\topcontent{\topcontent\setchord{##1}\hskip\minchordseparation}%
\else%
\currentlyricskip=\tempdimen%
\edef\topcontent{\topcontent\setchord{##1}\hskip\minchordseparation}%
\fi%
\fi%
\measure{\topcontent}%
\topline=\res%
}%
#1%
\ifdim\bottomline > \topline
\hbox{\hbox to 0pt{\topcontent\hss}\bottomcontent}%
\else
\hbox{\hbox to 0pt{\bottomcontent\hss}\topcontent}%
\fi
\ifdim\bottomline=0pt
\vskip -6pt
\fi
}}%
%
% Macros for verses and songs
%
\def\song#1{
\def\verse##1{\vbox{##1}\def\verse####1{\vskip\blockseparator\vbox{####1}}}
%\def\verse##1{{##1}\def\verse####1{\vskip\blockseparator{####1}}}
#1
}
%
% Macros for song headers
%
\newcount\songcount
\songcount=1
\font\numberfont=\fontname\tenbf\space scaled 2500
\font\namefont=\fontname\tenbf\space scaled 1500
\font\authorfont=\fontname\tenrm\space scaled 700
\def\numberstrut{\hbox{\vrule height 20pt width 0pt depth 3.5pt}}
\def\songheader#1#2{\hbox{\vbox{\hrule\hbox to 1.5cm{\vrule\hss\numberstrut\numberfont\the\songcount\vrule}\hrule}\hskip 0.5em\hbox{\vbox{\hbox{\namefont #1}\hbox{\authorfont #2}}}}\vskip\blockseparator\advance\songcount by 1}
\catcode`\#=11